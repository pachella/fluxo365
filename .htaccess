# ==========================================
# Sistema Base - Fluxo365
# Configuração Apache / mod_rewrite
# ==========================================

# Ativar reescrita
RewriteEngine On
RewriteBase /

# ==========================================
# SEGURANÇA
# ==========================================

# Desabilitar listagem de diretórios
Options -Indexes

# Bloquear acesso a arquivos sensíveis
<FilesMatch "\.(sql|log|md|env|git|gitignore|htaccess)$">
    Require all denied
</FilesMatch>

# Proteger arquivo de configuração
<Files "db.php">
    Require all denied
</Files>

# Permitir acesso apenas via PHP (não diretamente)
<FilesMatch "^(db|config|auth_check|PermissionManager|EmailService|ImageProcessor|cache_helper|version)\.php$">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
</FilesMatch>

# ==========================================
# FORÇAR HTTPS (OPCIONAL - DESCOMENTE SE TIVER SSL)
# ==========================================
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# ==========================================
# PERMISSÕES PARA ARQUIVOS ESTÁTICOS
# ==========================================

# Permitir acesso a arquivos estáticos (CSS, JS, imagens)
RewriteCond %{REQUEST_URI} \.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|webp|pdf)$ [NC]
RewriteRule . - [L]

# ==========================================
# ROTAS DO SISTEMA
# ==========================================

# Dashboard principal
RewriteRule ^dashboard/?$ modules/dashboard.php?page=dashboard/home [L,QSA]

# Roteamento geral do sistema
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} ^/([^/]+)/?(.*)$
RewriteRule ^([^/]+)/?(.*)$ modules/dashboard.php?page=$1/$2 [L,QSA]

# ==========================================
# PHP SETTINGS (OPCIONAL)
# ==========================================

# Aumentar limite de upload (se permitido pelo servidor)
# php_value upload_max_filesize 10M
# php_value post_max_size 10M
# php_value max_execution_time 300
# php_value max_input_time 300
